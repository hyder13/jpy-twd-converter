<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>æ—¥åœ“è½‰å°å¹£ | JPY to TWD</title>
    <link rel="manifest" href="manifest.json">
    <meta name="theme-color" content="#667eea">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <link rel="apple-touch-icon" href="icon.png">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            display: flex;
            justify-content: center;
            align-items: center;
            padding: 20px;
        }

        .container {
            background: white;
            border-radius: 24px;
            padding: 40px 30px;
            width: 100%;
            max-width: 380px;
            box-shadow: 0 20px 60px rgba(0,0,0,0.3);
        }

        .header {
            text-align: center;
            margin-bottom: 30px;
        }

        .header h1 {
            font-size: 24px;
            color: #333;
            margin-bottom: 8px;
        }

        .header .subtitle {
            color: #888;
            font-size: 14px;
        }

        .rate-badge {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 12px 20px;
            border-radius: 30px;
            text-align: center;
            margin-bottom: 30px;
            font-size: 14px;
            font-weight: 600;
        }

        .rate-badge .update-time {
            font-size: 11px;
            opacity: 0.8;
            margin-top: 4px;
            font-weight: normal;
        }

        .input-group {
            margin-bottom: 25px;
        }

        .input-group label {
            display: block;
            margin-bottom: 8px;
            color: #555;
            font-size: 14px;
            font-weight: 500;
        }

        .input-wrapper {
            position: relative;
            display: flex;
            align-items: center;
        }

        .currency-symbol {
            position: absolute;
            left: 16px;
            font-size: 18px;
            color: #667eea;
            font-weight: bold;
        }

        input[type="number"] {
            width: 100%;
            padding: 16px 16px 16px 40px;
            border: 2px solid #e0e0e0;
            border-radius: 12px;
            font-size: 24px;
            font-weight: 600;
            color: #333;
            transition: all 0.3s ease;
            outline: none;
        }

        input[type="number"]:focus {
            border-color: #667eea;
        }

        .result-box {
            background: linear-gradient(135deg, #f5f7fa 0%, #e4e8ec 100%);
            border-radius: 16px;
            padding: 25px;
            text-align: center;
            margin-top: 20px;
        }

        .result-label {
            font-size: 13px;
            color: #888;
            margin-bottom: 8px;
            text-transform: uppercase;
            letter-spacing: 1px;
        }

        .result-amount {
            font-size: 36px;
            font-weight: bold;
            color: #667eea;
            margin-bottom: 5px;
        }

        .result-detail {
            font-size: 13px;
            color: #888;
        }

        .quick-buttons {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 10px;
            margin-top: 25px;
        }

        .quick-btn {
            background: #f0f0f0;
            border: none;
            padding: 12px 8px;
            border-radius: 10px;
            font-size: 13px;
            font-weight: 600;
            color: #555;
            cursor: pointer;
            transition: all 0.2s ease;
        }

        .quick-btn:hover {
            background: #667eea;
            color: white;
        }

        .loading {
            display: inline-block;
            width: 16px;
            height: 16px;
            border: 2px solid rgba(255,255,255,0.3);
            border-radius: 50%;
            border-top-color: white;
            animation: spin 0.8s linear infinite;
            margin-left: 8px;
            vertical-align: middle;
        }

        @keyframes spin {
            to { transform: rotate(360deg); }
        }

        .error-message {
            background: #ffebee;
            color: #c62828;
            padding: 12px 16px;
            border-radius: 10px;
            font-size: 13px;
            margin-top: 15px;
            text-align: center;
            display: none;
        }

        .install-prompt {
            background: #e3f2fd;
            color: #1565c0;
            padding: 12px 16px;
            border-radius: 10px;
            font-size: 13px;
            margin-top: 20px;
            text-align: center;
            cursor: pointer;
        }

        .conversion-table {
            margin-top: 25px;
            background: #f8f9fa;
            border-radius: 16px;
            padding: 20px;
        }

        .conversion-table h3 {
            font-size: 14px;
            color: #555;
            margin-bottom: 15px;
            text-align: center;
        }

        .table-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 8px;
        }

        .table-row {
            display: flex;
            justify-content: space-between;
            padding: 8px 12px;
            background: white;
            border-radius: 8px;
            font-size: 13px;
        }

        .table-row .jpy {
            color: #888;
        }

        .table-row .twd {
            color: #667eea;
            font-weight: 600;
        }

        .table-row.highlight {
            background: linear-gradient(135deg, #667eea20 0%, #764ba220 100%);
            border: 1px solid #667eea40;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>ğŸ’´ æ—¥åœ“è½‰å°å¹£</h1>
            <p class="subtitle">å³æ™‚åŒ¯ç‡æ›ç®—</p>
        </div>

        <div class="rate-badge" id="rateBadge">
            è¼‰å…¥åŒ¯ç‡ä¸­<span class="loading"></span>
        </div>

        <div class="input-group">
            <label>æ—¥åœ“é‡‘é¡</label>
            <div class="input-wrapper">
                <span class="currency-symbol">Â¥</span>
                <input type="number" id="jpyInput" placeholder="0" min="0" step="1">
            </div>
        </div>

        <div class="result-box">
            <div class="result-label">å°å¹£é‡‘é¡</div>
            <div class="result-amount" id="twdResult">NT$ 0</div>
            <div class="result-detail" id="resultDetail">-</div>
        </div>

        <div class="quick-buttons">
            <button class="quick-btn" onclick="setAmount(1000)">Â¥1,000</button>
            <button class="quick-btn" onclick="setAmount(5000)">Â¥5,000</button>
            <button class="quick-btn" onclick="setAmount(10000)">Â¥1è¬</button>
            <button class="quick-btn" onclick="setAmount(50000)">Â¥5è¬</button>
        </div>

        <div class="error-message" id="errorMsg"></div>

        <div class="conversion-table">
            <h3>ğŸ“‹ å¿«é€Ÿå°ç…§è¡¨</h3>
            <div class="table-grid" id="conversionTable">
                <!-- ç”± JS å‹•æ…‹ç”Ÿæˆ -->
            </div>
        </div>

        <div class="install-prompt" id="installPrompt" onclick="showInstallHelp()">
            ğŸ“± é»æ­¤åŠ åˆ°ä¸»å±å¹•ï¼Œéš¨æ™‚å¿«é€Ÿé–‹å•Ÿ
        </div>
    </div>

    <script>
        let exchangeRate = 0.21; // é è¨­åŒ¯ç‡

        // è¼‰å…¥å³æ™‚åŒ¯ç‡
        async function loadExchangeRate() {
            const rateBadge = document.getElementById('rateBadge');
            
            try {
                // å˜—è©¦å¤šå€‹åŒ¯ç‡ API
                const apis = [
                    // ä½¿ç”¨ Yahoo Finance é–“æ¥å–å¾—
                    async () => {
                        // ä½¿ç”¨æœ¬åœ°å¿«å–æˆ–é è¨­å€¼ï¼Œå˜—è©¦å¾ GitHub ä¸Šçš„åŒ¯ç‡è³‡æ–™æ›´æ–°
                        const response = await fetch('https://api.exchangerate-api.com/v4/latest/JPY');
                        const data = await response.json();
                        return data.rates.TWD;
                    },
                    // å‚™ç”¨ï¼šä½¿ç”¨å›ºå®šä¾†æº
                    async () => {
                        // é€™è£¡å¯ä»¥æ›æˆä½ è‡ªå·±çš„ API
                        return 0.21;
                    }
                ];

                for (const api of apis) {
                    try {
                        exchangeRate = await api();
                        break;
                    } catch (e) {
                        console.log('API failed, trying next...');
                    }
                }

                updateRateDisplay();
                calculate(); // å¦‚æœæœ‰è¼¸å…¥ï¼Œé‡æ–°è¨ˆç®—
                generateConversionTable(); // æ›´æ–°å°ç…§è¡¨

            } catch (error) {
                console.error('åŒ¯ç‡è¼‰å…¥å¤±æ•—:', error);
                rateBadge.innerHTML = `Â¥1 = NT$${exchangeRate.toFixed(3)}<br><span class="update-time">ä½¿ç”¨é è¨­åŒ¯ç‡</span>`;
            }
        }

        function updateRateDisplay() {
            const rateBadge = document.getElementById('rateBadge');
            const now = new Date();
            const timeStr = now.toLocaleTimeString('zh-TW', { hour: '2-digit', minute: '2-digit' });
            rateBadge.innerHTML = `Â¥1 = NT$${exchangeRate.toFixed(4)}<br><span class="update-time">æ›´æ–°æ™‚é–“: ${timeStr}</span>`;
        }

        function calculate() {
            const jpyInput = document.getElementById('jpyInput');
            const twdResult = document.getElementById('twdResult');
            const resultDetail = document.getElementById('resultDetail');

            const jpy = parseFloat(jpyInput.value) || 0;
            const twd = Math.round(jpy * exchangeRate);

            if (jpy > 0) {
                twdResult.textContent = `NT$ ${twd.toLocaleString()}`;
                resultDetail.textContent = `Â¥${jpy.toLocaleString()} Ã— ${exchangeRate.toFixed(4)}`;
            } else {
                twdResult.textContent = 'NT$ 0';
                resultDetail.textContent = '-';
            }
        }

        function setAmount(amount) {
            document.getElementById('jpyInput').value = amount;
            calculate();
        }

        function showInstallHelp() {
            const isIOS = /iPad|iPhone|iPod/.test(navigator.userAgent);
            const isAndroid = /Android/.test(navigator.userAgent);

            if (isIOS) {
                alert('iOS å®‰è£æ–¹å¼ï¼š\n1. é»æ“Š Safari åº•éƒ¨çš„åˆ†äº«æŒ‰éˆ• â¬†ï¸\n2. é¸æ“‡ã€ŒåŠ å…¥ä¸»ç•«é¢ã€\n3. é»æ“Šã€ŒåŠ å…¥ã€');
            } else if (isAndroid) {
                alert('Android å®‰è£æ–¹å¼ï¼š\n1. é»æ“Š Chrome å³ä¸Šè§’é¸å–® â‹®\n2. é¸æ“‡ã€Œå®‰è£æ‡‰ç”¨ç¨‹å¼ã€æˆ–ã€ŒåŠ åˆ°ä¸»ç•«é¢ã€');
            } else {
                alert('è«‹ä½¿ç”¨ç€è¦½å™¨çš„ã€ŒåŠ åˆ°ä¸»ç•«é¢ã€åŠŸèƒ½');
            }
        }

        // ç”Ÿæˆå°ç…§è¡¨
        function generateConversionTable() {
            const tableGrid = document.getElementById('conversionTable');
            const amounts = [
                100, 200, 300, 400, 500,
                600, 700, 800, 900, 1000,
                2000, 3000, 4000, 5000
            ];

            let html = '';
            amounts.forEach((jpy, index) => {
                const twd = Math.round(jpy * exchangeRate);
                const isHighlight = jpy === 1000 || jpy === 5000;
                const highlightClass = isHighlight ? 'highlight' : '';

                html += `
                    <div class="table-row ${highlightClass}">
                        <span class="jpy">Â¥${jpy.toLocaleString()}</span>
                        <span class="twd">NT$${twd.toLocaleString()}</span>
                    </div>
                `;
            });

            tableGrid.innerHTML = html;
        }

        // äº‹ä»¶ç›£è½
        document.getElementById('jpyInput').addEventListener('input', calculate);

        // åˆå§‹åŒ–
        loadExchangeRate();
        generateConversionTable(); // å…ˆç”¨é è¨­åŒ¯ç‡ç”Ÿæˆè¡¨æ ¼

        // æ¯ 30 åˆ†é˜æ›´æ–°ä¸€æ¬¡åŒ¯ç‡
        setInterval(loadExchangeRate, 30 * 60 * 1000);
    </script>
</body>
</html>
